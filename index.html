<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meri — Daily Tracker</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #1a0f1f;
  --panel: #2b1830;
  --card: #351c3b;
  --text: #ffeaf4;
  --accent: #ff7dcf;
  --accent2: #ffa8e2;
  --muted: #d49fc8;
  --good: #ffb6c1;
  --warn: #ffda79;
  --danger: #ff6b81;
  --shadow: rgba(255, 105, 180, 0.25);
}

html, body {
  height: 100%;
  margin: 0;
  background: linear-gradient(180deg, #2c1030, #1a0f1f);
  color: var(--text);
  font-family: "Poppins", sans-serif;
}

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 30px 20px 80px;
  min-height: 100%;
}

.card {
  background: var(--card);
  border-radius: 16px;
  box-shadow: 0 10px 30px var(--shadow);
  padding: 20px;
  width: 100%;
  max-width: 1000px;
  margin-top: 25px;
  transition: transform 0.2s ease;
}
.card:hover { transform: translateY(-2px); }

.section-title {
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  font-size: 14px;
  color: var(--accent2);
  margin: 0 0 15px;
  border-bottom: 2px solid var(--accent);
  padding-bottom: 8px;
}

.controls {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  justify-content: center;
}

.btn {
  background: var(--panel);
  color: var(--text);
  border: none;
  border-radius: 10px;
  padding: 12px 18px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}
.btn:hover:not(:disabled) {
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  color: #fff;
}
.btn.primary { background: linear-gradient(90deg, var(--accent), var(--accent2)); color: #fff; }
.btn.success { background: #ffb6c1; color: #3a103f; }
.btn.warn { background: var(--warn); color: #3a103f; }
.btn.ghost { background: transparent; border: 1px solid var(--accent); }

.form input, .form select, .form textarea {
  background: var(--panel);
  color: var(--text);
  border: 1px solid var(--accent);
  border-radius: 8px;
  padding: 10px 12px;
  outline: none;
}
.form input:focus, .form select:focus, .form textarea:focus {
  box-shadow: 0 0 0 2px var(--accent2);
}

#clockInStatus {
  font-weight: 600;
  color: var(--good);
  background: rgba(255, 182, 193, 0.15);
  padding: 8px;
  border-radius: 8px;
  margin-top: 10px;
  text-align: center;
}

.clock {
  text-align: center;
  font-size: 50px;
  font-weight: 700;
  color: var(--accent);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 0.9em;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
thead th {
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--accent);
}
tbody tr:hover { background: rgba(255, 255, 255, 0.05); }

.slot {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--panel);
  padding: 8px 12px;
  border-radius: 8px;
  color: var(--text);
  font-size: 0.9em;
}
.slot:hover { background: var(--accent); color: #fff; }

.chart-container { margin-top: 20px; }

.day-btn {
  display: inline-block;
  padding: 6px 10px;
  margin: 4px;
  background: var(--panel);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.day-btn:hover { background: var(--accent2); color: #fff; }

.year-month {
  text-align: center;
  color: var(--accent);
  font-weight: 600;
  margin-bottom: 10px;
}

.nav-buttons {
  text-align: center;
  margin-bottom: 10px;
}
.nav-buttons button {
  background: transparent;
  border: none;
  color: var(--accent2);
  font-weight: 700;
  font-size: 18px;
  cursor: pointer;
}
</style>
</head>

<body>
<div class="container">
  <div id="authSection" class="card">
    <div class="section-title">Log in or Sign up</div>
    <form id="authForm" class="form">
      <input type="email" id="authEmail" placeholder="Email" required>
      <input type="password" id="authPassword" placeholder="Password" required>
      <button class="btn primary" type="submit">Continue</button>
    </form>
  </div>

  <div id="dateSelectorPage" style="display:none;">
    <div class="nav-buttons">
      <button id="prevMonth">←</button>
      <span id="monthYear" class="year-month"></span>
      <button id="nextMonth">→</button>
    </div>
    <div id="dateSelector"></div>
  </div>

  <div id="mainApp" style="display:none;">
    <div class="controls">
      <button id="logoutBtn" class="btn ghost">Log out</button>
    </div>

    <h2 id="selectedDateHeader" style="text-align:center;margin-top:10px;"></h2>

    <div class="card">
      <div class="section-title">Clock</div>
      <div class="clock" id="clockDisplay"></div>
    </div>

    <div class="card">
      <div class="section-title">Clock In / Clock Out</div>
      <form class="form" onsubmit="return false;">
        <input id="activity" placeholder="What are you doing?">
        <select id="category">
          <option>No tag</option><option>Study</option><option>Work</option><option>Gym</option>
          <option>Deep Work</option><option>Content</option><option>Admin</option>
        </select>
        <textarea id="notes" placeholder="Notes (optional)"></textarea>
        <button id="clockInBtn" class="btn success" type="button">Clock In</button>
        <button id="clockOutBtn" class="btn warn" type="button" disabled>Clock Out</button>
      </form>
      <div id="clockInStatus">Not currently clocked in.</div>
    </div>

    <div class="card">
      <div class="section-title">Entries</div>
      <table><thead><tr><th>Date</th><th>Start</th><th>End</th><th>Activity</th><th>Tag</th><th>Notes</th></tr></thead>
      <tbody id="entriesBody"></tbody></table>
    </div>

    <div class="card">
      <div class="section-title">Creator Sessions</div>
      <div class="form">
        <button id="creatorWithBtn" class="btn primary">Start Creator (With Social)</button>
        <button id="creatorNoBtn" class="btn success">Start Creator (No Social)</button>
        <button id="creatorStopBtn" class="btn warn" disabled>Stop</button>
      </div>
      <div id="creatorStatus" style="margin-top:10px;">No active session.</div>

      <div id="slotsGrid"
        style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px;margin-top:12px;"></div>

      <div class="chart-container">
        <canvas id="checkboxChart" height="150"></canvas>
      </div>
    </div>

    <div class="card">
      <div class="section-title">Creator Entries</div>
      <table><thead><tr><th>Date</th><th>Start</th><th>End</th><th>Activity</th></tr></thead>
      <tbody id="creatorEntriesBody"></tbody></table>
    </div>
  </div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supabase = createClient("https://eqqunclfxzmfosjwzwki.supabase.co", "YOUR_SUPABASE_ANON_KEY");

// utilities
const pad = n => n.toString().padStart(2, "0");
let chart;
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

// clock
function tickClock() {
  const n = new Date();
  document.getElementById("clockDisplay").textContent = `${pad(n.getHours())}:${pad(n.getMinutes())}:${pad(n.getSeconds())}`;
}
setInterval(tickClock, 1000);

// auth
document.getElementById("authForm").onsubmit = async e => {
  e.preventDefault();
  const email = authEmail.value, password = authPassword.value;
  let { error } = await supabase.auth.signInWithPassword({ email, password });
  if (error) {
    let { error: e2 } = await supabase.auth.signUp({ email, password });
    if (e2) return alert(e2.message);
    alert("Signed up! Please log in again.");
  } else setupAfterLogin();
};
document.getElementById("logoutBtn").onclick = async () => { await supabase.auth.signOut(); location.reload(); };

// date selector
function buildDateSelector() {
  const monthYear = document.getElementById("monthYear");
  const c = document.getElementById("dateSelector");
  const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  monthYear.textContent = `${months[currentMonth]} ${currentYear}`;
  c.innerHTML = "";
  const days = new Date(currentYear, currentMonth + 1, 0).getDate();
  for (let d = 1; d <= days; d++) {
    const b = document.createElement("div");
    b.className = "day-btn";
    b.textContent = d;
    b.onclick = () => openDay(currentYear, currentMonth, d);
    c.appendChild(b);
  }
}
document.getElementById("prevMonth").onclick = () => { if (--currentMonth < 0) { currentMonth = 11; currentYear--; } buildDateSelector(); };
document.getElementById("nextMonth").onclick = () => { if (++currentMonth > 11) { currentMonth = 0; currentYear++; } buildDateSelector(); };
buildDateSelector();

// open day
function openDay(y, m, d) {
  const sel = new Date(y, m, d);
  localStorage.setItem("meri_selected_date", sel.toISOString());
  document.getElementById("dateSelectorPage").style.display = "none";
  document.getElementById("mainApp").style.display = "block";
  selectedDateHeader.textContent = `${d} ${sel.toLocaleString("default", { month: "long" })} ${y}`;
  buildSlots();
}

// checkboxes grid
function buildSlots() {
  const g = document.getElementById("slotsGrid");
  g.innerHTML = "";
  for (let i = 0; i < 48; i++) {
    const H = Math.floor(i / 2), M = i % 2 === 0 ? 0 : 30;
    const lbl = `${pad(H)}:${pad(M)}`;
    const div = document.createElement("div");
    div.className = "slot";
    div.innerHTML = `<span>${lbl}</span><input type="checkbox" data-label="${lbl}">`;
    g.appendChild(div);
  }
  g.querySelectorAll("input").forEach(cb => cb.checked = false);
  g.onchange = updateChart;
  updateChart();
}

// chart
function updateChart() {
  const total = 48;
  const checked = document.querySelectorAll("#slotsGrid input:checked").length;
  const ctx = document.getElementById("checkboxChart").getContext("2d");
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "doughnut",
    data: { labels: ["Done", "Remaining"], datasets: [{ data: [checked, total - checked], backgroundColor: ["#ff7dcf", "#a86dd8"] }] },
    options: { plugins: { title: { display: true, text: `${checked}/48 Slots Completed`, color: "#ffeaf4" }, legend: { labels: { color: "#ffeaf4" } } } }
  });
}

// after login
async function setupAfterLogin() {
  authSection.style.display = "none";
  dateSelectorPage.style.display = "block";
}
</script>
</body>
</html>

