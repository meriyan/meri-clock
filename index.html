<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MeriV Productivity</title>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background-color: #0d1117;
    color: #e6edf3;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 900px;
    margin: auto;
  }
  .section {
    background-color: #161b22;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
  }
  h2 {
    color: #58a6ff;
    margin-top: 0;
  }
  input, select, textarea, button {
    border-radius: 5px;
    border: none;
    padding: 8px 10px;
    margin: 5px 0;
  }
  button {
    background-color: #238636;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background-color: #2ea043;
  }
  .clock {
    font-size: 40px;
    text-align: center;
    letter-spacing: 2px;
  }
  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 6px;
  }
  .checkbox-item {
    background-color: #21262d;
    border-radius: 5px;
    padding: 5px;
    text-align: center;
  }
</style>
</head>
<body>
<div class="container">
  <h2>Flip Clock</h2>
  <div id="flipClock" class="clock"></div>

  <div class="section" id="clockSection">
    <h2>Clock In / Clock Out</h2>
    <input id="activity" type="text" placeholder="What are you doing?" />
    <input id="tag" type="text" placeholder="Tag (optional)" />
    <textarea id="notes" placeholder="Notes (optional)"></textarea><br>
    <button id="clockIn">Clock In</button>
    <button id="clockOut">Clock Out</button>
  </div>

  <div class="section" id="creatorZone">
    <h2>Creator Zone</h2>
    <button id="startCreatorWith">Start Creator (With Social)</button>
    <button id="startCreatorWithout">Start Creator (No Social)</button>
    <button id="stopCreator">Stop Session</button>
    <div id="creatorStatus">No active session.</div>
  </div>

  <div class="section" id="checkboxes">
    <h2>Today's 30-Minute Checkboxes</h2>
    <div class="checkbox-grid" id="checkboxGrid"></div>
  </div>
</div>

<script>
const { createClient } = supabase;
const supabaseUrl = "YOUR_SUPABASE_URL";
const supabaseKey = "YOUR_SUPABASE_ANON_KEY";
const supabaseClient = createClient(supabaseUrl, supabaseKey);

// Update live clock
function updateClock() {
  document.getElementById("flipClock").innerText =
    new Date().toLocaleTimeString();
}
setInterval(updateClock, 1000);
updateClock();

let activeCreatorSession = null;

// Clock in / out
document.getElementById("clockIn").onclick = async () => {
  const activity = document.getElementById("activity").value;
  const tag = document.getElementById("tag").value;
  const notes = document.getElementById("notes").value;

  await supabaseClient.from("logs").insert({
    activity,
    tag,
    notes,
    start_time: new Date().toISOString(),
  });
  alert("Clocked in successfully ✅");
};

document.getElementById("clockOut").onclick = async () => {
  const { data } = await supabaseClient
    .from("logs")
    .select("*")
    .order("id", { ascending: false })
    .limit(1);
  if (data && data.length > 0) {
    await supabaseClient
      .from("logs")
      .update({ end_time: new Date().toISOString() })
      .eq("id", data[0].id);
    alert("Clocked out ✅");
  }
};

// Creator sessions
document.getElementById("startCreatorWith").onclick = async () => {
  if (activeCreatorSession) return;
  const { data, error } = await supabaseClient.from("social_sessions").insert({
    type: "creator_with",
    start_time: new Date().toISOString(),
  });
  if (!error) {
    activeCreatorSession = true;
    document.getElementById("creatorStatus").innerText =
      "Creator session started (with social).";
  }
};

document.getElementById("startCreatorWithout").onclick = async () => {
  if (activeCreatorSession) return;
  const { data, error } = await supabaseClient.from("social_sessions").insert({
    type: "creator_without",
    start_time: new Date().toISOString(),
  });
  if (!error) {
    activeCreatorSession = true;
    document.getElementById("creatorStatus").innerText =
      "Creator session started (no social).";
  }
};

document.getElementById("stopCreator").onclick = async () => {
  if (!activeCreatorSession) return;
  const { data } = await supabaseClient
    .from("social_sessions")
    .select("*")
    .order("id", { ascending: false })
    .limit(1);
  if (data && data.length > 0) {
    await supabaseClient
      .from("social_sessions")
      .update({ end_time: new Date().toISOString() })
      .eq("id", data[0].id);
  }
  activeCreatorSession = null;
  document.getElementById("creatorStatus").innerText = "No active session.";
};

// 30-minute checkbox system
const grid = document.getElementById("checkboxGrid");
const times = [];
for (let h = 0; h < 24; h++) {
  for (let m = 0; m < 60; m += 30) {
    const t = `${h.toString().padStart(2, "0")}:${m
      .toString()
      .padStart(2, "0")}`;
    times.push(t);
  }
}

async function loadCheckboxes() {
  const today = new Date().toISOString().split("T")[0];
  const { data } = await supabaseClient
    .from("social_checks")
    .select("*")
    .eq("date", today);
  grid.innerHTML = "";
  times.forEach((time) => {
    const box = document.createElement("input");
    box.type = "checkbox";
    const found = data?.find((x) => x.time_slot === time);
    if (found && found.checked) box.checked = true;
    box.onchange = async () => {
      await supabaseClient.from("social_checks").upsert({
        date: today,
        time_slot: time,
        checked: box.checked,
      });
    };
    const div = document.createElement("div");
    div.className = "checkbox-item";
    div.textContent = time;
    div.appendChild(box);
    grid.appendChild(div);
  });
}

loadCheckboxes();
</script>
</body>
</html>
