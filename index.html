<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meri Clock</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #1a001f;
      color: #f7c6ff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1, h2, h3 {
      color: #ffb6ff;
    }
    .clock {
      font-size: 48px;
      margin: 20px 0;
      color: #ffb6ff;
      text-shadow: 0 0 10px #ff80c8;
    }
    .section {
      margin: 30px auto;
      padding: 20px;
      border: 1px solid #ff80c8;
      border-radius: 15px;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 0 20px rgba(255, 182, 255, 0.2);
      background-color: rgba(255, 182, 255, 0.05);
    }
    button {
      background-color: #ff80c8;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
      transition: 0.3s;
    }
    button:hover {
      background-color: #ff9ee0;
    }
    input, select {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ff80c8;
      background-color: #2b0033;
      color: #f7c6ff;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 90%;
      max-width: 800px;
    }
    th, td {
      border: 1px solid #ff80c8;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #2b0033;
      color: #ffb6ff;
    }
    td {
      background-color: #1a001f;
    }
    .small-text {
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <h1>ðŸ’– Meriâ€™s Motivational Clock ðŸ’–</h1>
  <div class="clock" id="mainClock"></div>

  <div class="section">
    <h2>Select Date</h2>
    <input type="date" id="selectedDate" />
  </div>

  <div class="section">
    <h2>Clock In / Clock Out</h2>
    <input type="text" id="activityInput" placeholder="What are you doing?" />
    <select id="tagInput">
      <option value="">No tag</option>
      <option value="Study">Study</option>
      <option value="Work">Work</option>
      <option value="Fitness">Fitness</option>
      <option value="Other">Other</option>
    </select>
    <input type="text" id="notesInput" placeholder="Notes (optional)" />
    <button id="clockInBtn">Clock In</button>
    <button id="clockOutBtn">Clock Out</button>
    <div id="clockStatus" class="small-text">Not currently clocked in.</div>
  </div>

  <div class="section">
    <h2>Entries</h2>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Start</th>
          <th>End</th>
          <th>Duration</th>
          <th>Activity</th>
          <th>Tag</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody id="entriesTable"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Creator Sessions</h2>
    <button id="startCreatorSocial">Start Creator (With Social)</button>
    <button id="startCreatorNoSocial">Start Creator (No Social)</button>
    <button id="stopCreator">Stop</button>
    <div class="small-text">Session Timer: <span id="creatorTimer">00:00</span></div>
  </div>

  <div class="section">
    <h2 id="monthTitle"></h2>
    <table>
      <tbody id="timeSlotsTable"></tbody>
    </table>
  </div>

  <script>
    // âœ… Initialize Supabase
    const supabaseUrl = "https://YOUR_PROJECT_URL.supabase.co";
    const supabaseKey = "YOUR_SUPABASE_ANON_KEY";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    const user_id = "meri_default_user"; // static user ID

    // âœ… Persistent Date Selection
    const dateInput = document.getElementById("selectedDate");
    const savedDate = localStorage.getItem("selectedDate");
    if (savedDate) {
      dateInput.value = savedDate;
    } else {
      const today = new Date().toISOString().split("T")[0];
      dateInput.value = today;
      localStorage.setItem("selectedDate", today);
    }
    dateInput.addEventListener("change", () => {
      localStorage.setItem("selectedDate", dateInput.value);
    });

    // âœ… Flip Clock
    function updateClock() {
      const now = new Date();
      document.getElementById("mainClock").textContent = now.toLocaleTimeString("en-GB");
    }
    setInterval(updateClock, 1000);
    updateClock();

    // âœ… Month title
    const monthNames = [
      "January","February","March","April","May","June","July","August","September","October","November","December"
    ];
    const now = new Date();
    document.getElementById("monthTitle").textContent = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;

    // âœ… Generate half-hour slots
    const table = document.getElementById("timeSlotsTable");
    for (let h = 0; h < 24; h++) {
      const row = document.createElement("tr");
      for (let m = 0; m < 2; m++) {
        const td = document.createElement("td");
        const timeLabel = document.createTextNode(`${String(h).padStart(2, "0")}:${m === 0 ? "00" : "30"}`);
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = false;
        td.appendChild(timeLabel);
        td.appendChild(document.createElement("br"));
        td.appendChild(checkbox);
        row.appendChild(td);
      }
      table.appendChild(row);
    }

    // âœ… Clock In/Out
    let clockedIn = false;
    let startTime;

    document.getElementById("clockInBtn").addEventListener("click", () => {
      if (clockedIn) return alert("Already clocked in!");
      clockedIn = true;
      startTime = new Date();
      document.getElementById("clockStatus").textContent = "Clocked in at " + startTime.toLocaleTimeString("en-GB");
    });

    document.getElementById("clockOutBtn").addEventListener("click", async () => {
      if (!clockedIn) return alert("Not clocked in!");
      clockedIn = false;
      const endTime = new Date();
      const durationMs = endTime - startTime;
      const durationMin = Math.floor(durationMs / 60000);
      const durationFormatted = `${Math.floor(durationMin / 60)}h ${durationMin % 60}m`;

      const activity = document.getElementById("activityInput").value;
      const tag = document.getElementById("tagInput").value;
      const notes = document.getElementById("notesInput").value;
      const session_date = document.getElementById("selectedDate").value;

      try {
        const { data, error } = await supabase.from("logs").insert([
          {
            user_id,
            activity,
            tag,
            notes,
            start_time: startTime.toISOString(),
            end_time: endTime.toISOString(),
            log_date: session_date,
          },
        ]);
        if (error) console.error("Insert error:", error);
      } catch (err) {
        console.error("Network error:", err);
      }

      const row = `<tr>
        <td>${session_date}</td>
        <td>${startTime.toLocaleTimeString("en-GB")}</td>
        <td>${endTime.toLocaleTimeString("en-GB")}</td>
        <td>${durationFormatted}</td>
        <td>${activity}</td>
        <td>${tag}</td>
        <td>${notes}</td>
      </tr>`;
      document.getElementById("entriesTable").innerHTML += row;

      document.getElementById("clockStatus").textContent = "Not currently clocked in.";
    });

    // âœ… Creator Sessions
    let creatorTimerActive = false;
    let creatorStartTime;
    let creatorUsageType;
    let creatorInterval;

    function startCreatorTimer() {
      creatorStartTime = new Date();
      creatorInterval = setInterval(() => {
        const diff = Math.floor((new Date() - creatorStartTime) / 1000);
        const min = String(Math.floor(diff / 60)).padStart(2, "0");
        const sec = String(diff % 60).padStart(2, "0");
        document.getElementById("creatorTimer").textContent = `${min}:${sec}`;
      }, 1000);
    }

    function stopCreatorTimer() {
      clearInterval(creatorInterval);
      document.getElementById("creatorTimer").textContent = "00:00";
    }

    async function saveCreatorSession(startTime, endTime, usageType) {
      const session_date = document.getElementById("selectedDate").value;
      try {
        const { data, error } = await supabase.from("social_sessions").insert([
          {
            user_id,
            start_time: startTime.toISOString(),
            end_time: endTime.toISOString(),
            usage_type: usageType,
            session_date,
          },
        ]);
        if (error) throw error;
        console.log("Creator session saved:", data);
      } catch (err) {
        console.error("Creator session failed:", err);
        alert("Save creator session failed: " + err);
      }
    }

    document.getElementById("startCreatorSocial").addEventListener("click", () => {
      creatorTimerActive = true;
      creatorUsageType = "With Social";
      startCreatorTimer();
    });

    document.getElementById("startCreatorNoSocial").addEventListener("click", () => {
      creatorTimerActive = true;
      creatorUsageType = "No Social";
      startCreatorTimer();
    });

    document.getElementById("stopCreator").addEventListener("click", async () => {
      if (!creatorTimerActive) return;
      creatorTimerActive = false;
      const endTime = new Date();
      stopCreatorTimer();
      await saveCreatorSession(creatorStartTime, endTime, creatorUsageType);
    });
  </script>
</body>
</html>



