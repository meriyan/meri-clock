<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meri — Daily Tracker</title>
  
  <style>
/* Define the color scheme for a sleek dark mode */
:root {
    --bg: #0d1117; 
    --panel: #161b22; 
    --card: #1f252d; 
    --text: #c9d1d9; 
    --accent: #58a6ff;
    --muted: #8b949e; 
    --good: #3fb950; 
    --warn: #d29922; 
    --danger: #f85149; 
    --shadow: rgba(0,0,0,0.5);
}

html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-size: 16px;
}

.container {
    min-height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px 20px 80px;
}

.card {
    background: var(--card);
    border: 1px solid var(--panel);
    border-radius: 16px;
    box-shadow: 0 10px 30px var(--shadow);
    padding: 20px;
    max-width: 1000px;
    width: 100%;
    margin-top: 25px;
    transition: transform 0.2s;
}

.section-title {
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-size: 14px;
    color: var(--accent);
    margin: 0 0 15px;
    border-bottom: 2px solid var(--panel);
    padding-bottom: 8px;
}

h2 { color: var(--text); font-weight: 600; }

.controls {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
}

.btn {
    background: var(--panel);
    color: var(--text);
    border: none;
    border-radius: 8px;
    padding: 12px 18px;
    font-weight: 500;
    cursor: pointer;
    user-select: none;
    transition: all 0.2s ease;
}
.btn:hover:not(:disabled) { background-color: var(--card); box-shadow: 0 0 0 2px var(--accent); }
.btn.primary { background: var(--accent); color: #fff; }
.btn.success { background: var(--good); color: #fff; }
.btn.warn { background: var(--warn); color: var(--bg); }
.btn.ghost { background: transparent; border: 1px solid var(--muted); }
.btn:disabled { opacity: 0.4; cursor: not-allowed; }

.form {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}
.form input, .form select, .form textarea {
    background: var(--panel);
    color: var(--text);
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 10px 12px;
    outline: none;
    flex-grow: 1;
    min-width: 150px;
    transition: border-color 0.2s;
}
.form input:focus, .form select:focus, .form textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent);
}
#notes { flex-basis: 100%; resize: vertical; min-height: 80px; }
#clockInStatus { font-weight: 600; color: var(--good); font-size: 1em; margin-top: 15px; padding: 8px; background: rgba(63,185,80,0.1); border-radius: 8px; }

.clock {
    display: flex;
    gap: 20px;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    margin: 10px 0;
}
.colon {
    font-weight: 800;
    font-size: 56px;
    color: var(--muted);
    position: relative;
    top: -10px;
}
.flip {
    position: relative;
    width: 80px;
    height: 100px;
    perspective: 1000px;
}
.card-face {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    background: linear-gradient(180deg, var(--card), #12161b);
    border: 1px solid var(--panel);
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    overflow: hidden;
}
.digit {
    font-size: 60px;
    font-weight: 700;
    color: var(--accent);
}
.half {
    position: absolute;
    left: 0;
    right: 0;
    height: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-variant-numeric: tabular-nums;
}
.top { top: 0; border-bottom: 1px solid rgba(0,0,0,0.35); }
.bottom { bottom: 0; }

table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 15px;
    font-size: 0.9em;
}
th, td { padding: 12px 10px; text-align: left; border-bottom: 1px solid #30363d; }
thead th { font-size: 11px; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted); }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background-color: rgba(90,166,255,0.05); }

.mini-timer { font-weight: 800; font-variant-numeric: tabular-nums; color: var(--accent); }
.slot { display: flex; align-items: center; justify-content: space-between; background: var(--panel); padding: 10px 12px; border-radius: 6px; transition: background-color 0.2s; }
.slot:hover { background: #262e38; }

@media (max-width: 600px) {
    .container { padding: 15px 10px 60px; }
    .card { padding: 15px; margin-top: 15px; }
    .flip { width: 60px; height: 80px; }
    .digit { font-size: 40px; }
    .colon { font-size: 40px; }
}
  </style>
  
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const SUPABASE_URL="https://eqqunclfxzmfosjwzwki.supabase.co";
    const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxcXVuY2xmeHptZm9zand6d2tpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NDg1MDQsImV4cCI6MjA3NzUyNDUwNH0.1N5pYTxFf6PjCMgQ0nUICsc9jLL58LuDZgX_s8yLe_w";
    const supabase=createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

    const pad=n=>n.toString().padStart(2,"0");
    const months=["January","February","March","April","May","June","July","August","September","October","November","December"];
    let clockInInterval, creatorSessionInterval, creatorStartTime;

    function startOfDayUtc(d){const x=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0);return new Date(x.getTime()-x.getTimezoneOffset()*60000);}
    function nextDayUtc(d){const x=new Date(d.getFullYear(),d.getMonth(),d.getDate()+1,0,0,0);return new Date(x.getTime()-x.getTimezoneOffset()*60000);}
    async function getCurrentUser(){const {data:{user}}=await supabase.auth.getUser();return user;}

    async function handleAuth(e){
      e.preventDefault();
      const email=document.getElementById("authEmail").value;
      const password=document.getElementById("authPassword").value;
      let {error}=await supabase.auth.signInWithPassword({email,password});
      if(error){
        const {error:e2}=await supabase.auth.signUp({email,password});
        if(e2)return alert("Auth error: "+e2.message);
        alert("Signup successful! Please log in.");
      } else alert("Login successful!");
      setupAfterLogin();
    }

    async function handleLogout(){await supabase.auth.signOut();localStorage.removeItem("meri_selected_date");location.reload();}

    // ✅ FIXED tickClock
    function tickClock() {
      const n = new Date();
      const h = pad(n.getHours());
      const m = pad(n.getMinutes());
      const s = pad(n.getSeconds());

      const clockEl = document.querySelector('.clock');
      if (!clockEl.dataset.initialized) {
        clockEl.innerHTML = `
          <div id="hoursSeg" class="segment"></div>
          <div class="colon">:</div>
          <div id="minsSeg" class="segment"></div>
          <div class="colon">:</div>
          <div id="secsSeg" class="segment"></div>
        `;
        clockEl.dataset.initialized = "true";
      }

      renderDigits("hoursSeg", h);
      renderDigits("minsSeg", m);
      renderDigits("secsSeg", s);
    }

    function renderDigits(id,str){
      const seg=document.getElementById(id);
      if(!seg) return;
      seg.innerHTML="";
      for(const ch of str){
        const e=document.createElement("div");
        e.className="flip";
        e.innerHTML=`<div class="card-face"><div class="half top"><div class="digit">${ch}</div></div><div class="half bottom"><div class="digit">${ch}</div></div></div>`;
        seg.appendChild(e);
      }
    }

    // (Rest of your code stays unchanged…)
    // -- Clock in/out, Supabase logic, setupAfterLogin, event listeners --
    window.addEventListener("DOMContentLoaded", async () => {
      document.getElementById("mainApp").style.display = "none";
      document.getElementById("dateSelectorPage").style.display = "none";
      const { data: { session } } = await supabase.auth.getSession();
      document.getElementById("authForm").addEventListener("submit", handleAuth);
      document.getElementById("logoutBtn").addEventListener("click", handleLogout);
      setInterval(tickClock, 1000);
      if (!session?.user) {
          document.getElementById("authSection").style.display = "block";
          return;
      }
      await setupAfterLogin();
    });
  </script>
</head>

<body>
  <div class="container">
    <div id="authSection" class="card">
      <div class="section-title">Log in or Sign up</div>
      <form id="authForm" class="form">
        <input type="email" id="authEmail" placeholder="Email" required />
        <input type="password" id="authPassword" placeholder="Password" required />
        <button class="btn primary" type="submit">Continue</button>
      </form>
    </div>

    <div id="mainApp" style="display:none">
      <div class="card">
        <div class="section-title">Flip Clock</div>
        <div class="clock"></div>
      </div>
    </div>
  </div>
</body>
</html>

