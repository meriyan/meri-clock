<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meri — Flip Clock + Time Logger</title>
<style>
  :root{
    --bg:#0b0c10;
    --panel:#13161b;
    --card:#14161a;
    --text:#e8ecf1;
    --accent:#7aa7ff;
    --muted:#9aa3b2;
    --good:#3dcc7b;
    --warn:#ffc24d;
    --danger:#ff6b6b;
    --shadow:rgba(0,0,0,.4);
  }
  [data-theme="light"]{
    --bg:#f7f9fc;
    --panel:#eef2f8;
    --card:#ffffff;
    --text:#0b0c10;
    --accent:#245cff;
    --muted:#566074;
    --good:#1ea05e;
    --warn:#c08a00;
    --danger:#d94141;
    --shadow:rgba(0,0,0,.08);
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  }
  .container{
    min-height:100%;
    display:flex; flex-direction:column; gap:18px;
    align-items:center; padding:24px 20px 80px;
  }
  .grid{
    width:100%; max-width:1100px;
    display:grid; grid-template-columns:1.1fr .9fr;
    gap:18px;
  }
  @media (max-width: 940px){
    .grid{ grid-template-columns:1fr; }
  }

  /* controls */
  .controls{
    display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:center;
  }
  .chip, .btn{
    background:var(--card); color:var(--text);
    border:1px solid rgba(255,255,255,.06);
    border-radius:10px; padding:10px 14px;
    box-shadow:0 8px 24px var(--shadow);
    cursor:pointer; user-select:none;
  }
  .btn.primary{ border-color: transparent; background:linear-gradient(180deg, var(--accent), #436cff); color:white; }
  .btn.success{ background:linear-gradient(180deg, var(--good), #1b8b52); color:white; border-color:transparent; }
  .btn.warn{ background:linear-gradient(180deg, var(--warn), #a37400); color:white; border-color:transparent; }
  .btn.ghost{ background:transparent; border:1px dashed rgba(255,255,255,.18); }
  .btn:disabled{ opacity:.6; cursor:not-allowed; }
  .switch{ display:inline-flex; align-items:center; gap:8px; }
  .switch .dot{ width:12px;height:12px;border-radius:50%; background:var(--accent); box-shadow:0 0 0 3px rgba(122,167,255,.2) inset; }

  .card{
    background:var(--card);
    border:1px solid rgba(255,255,255,.06);
    border-radius:14px; box-shadow:0 16px 40px var(--shadow);
    padding:18px;
  }
  .section-title{ font-weight:700; letter-spacing:.04em; text-transform:uppercase; font-size:12px; color:var(--muted); margin:0 0 12px; }

  .date-line{ text-align:center; color:var(--muted); margin-top:4px; }

  /* Flip clock */
  .clock{ display:flex; gap:16px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .segment{ display:flex; gap:8px; }
  .colon{ font-weight:800; font-size:48px; opacity:.75; position:relative; top:-8px; }
  .label{ text-align:center; font-size:12px; color:var(--muted); letter-spacing:.14em; text-transform:uppercase; margin-top:8px; }

  .flip{ position:relative; width:92px; height:120px; perspective:1000px; }
  @media (max-width: 560px){ .flip{ width:64px; height:84px; } }
  .card-face{ position:relative; width:100%; height:100%; border-radius:14px; background:linear-gradient(180deg, var(--card), #0f1116);
    border:1px solid rgba(255,255,255,.06); overflow:hidden; box-shadow:0 16px 40px var(--shadow); }
  .half{ position:absolute; left:0; right:0; height:50%; display:flex; align-items:center; justify-content:center; font-weight:800; font-variant-numeric:tabular-nums; }
  .top{ top:0; border-bottom:1px solid rgba(0,0,0,.35); }
  .bottom{ bottom:0; }
  .digit{ font-size:68px; }
  @media (max-width:560px){ .digit{ font-size:48px; } }
  .top-flip, .bottom-flip{ position:absolute; left:0; right:0; height:50%; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; overflow:hidden; }
  .top-flip{ top:0; transform-origin:bottom; border-bottom:1px solid rgba(0,0,0,.35); background:linear-gradient(180deg, var(--card), #0f1116); }
  .bottom-flip{ bottom:0; transform-origin:top; background:linear-gradient(180deg, var(--card), #0f1116); }

  /* Logger form */
  .form{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .form input, .form textarea, .form select{
    background:var(--panel); color:var(--text); border:1px solid rgba(255,255,255,.06);
    border-radius:10px; padding:10px 12px; outline:none; min-width:160px;
  }
  .form textarea{ min-width:260px; min-height:40px; }
  .status{
    margin-top:8px; font-size:14px;
  }
  .status .pill{
    display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:rgba(122,167,255,.12); border:1px solid rgba(122,167,255,.3);
  }

  /* Table */
  table{ width:100%; border-collapse:separate; border-spacing:0; }
  th, td{ padding:10px 12px; text-align:left; border-bottom:1px solid rgba(255,255,255,.08); }
  thead th{ font-size:12px; letter-spacing:.12em; text-transform:uppercase; color:var(--muted); }
  tbody tr:hover{ background:rgba(255,255,255,.03); }
  .right{ text-align:right; }
  .actions{ display:flex; gap:8px; }
  .tag{ font-size:12px; padding:2px 8px; border-radius:999px; background:rgba(122,167,255,.12); border:1px solid rgba(122,167,255,.24); }

  .footer{
    position:fixed; bottom:10px; left:0; right:0; display:flex; justify-content:center;
    color:var(--muted); font-size:12px;
  }
  .footer strong{ color:var(--text); }
</style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <label class="chip switch" title="Toggle light/dark">
        <input id="themeToggle" type="checkbox" />
        <span class="dot"></span><span>Light</span>
      </label>
      <label class="chip switch" title="Toggle 24h/12h">
        <input id="formatToggle" type="checkbox" checked />
        <span class="dot"></span><span>24-hour</span>
      </label>
      <button id="fullscreenBtn" class="btn">Full screen</button>
      <button id="exportBtn" class="btn primary" title="Export entries to CSV">Export CSV</button>
      <button id="clearBtn" class="btn ghost" title="Clear all entries">Clear All</button>
    </div>

    <div class="grid">
      <div class="card">
        <div class="section-title">Flip Clock</div>
        <div class="date-line" id="dateLine">—</div>
        <div class="clock" aria-live="polite" style="margin-top:10px;">
          <div class="segment" id="hoursSeg" aria-label="Hours"></div>
          <div class="colon">:</div>
          <div class="segment" id="minsSeg" aria-label="Minutes"></div>
          <div class="colon">:</div>
          <div class="segment" id="secsSeg" aria-label="Seconds"></div>
        </div>
        <div class="label" id="tzLabel">—</div>
      </div>

      <div class="card">
        <div class="section-title">Clock In / Clock Out</div>
        <form class="form" id="logForm" onsubmit="return false;">
          <input type="text" id="activity" placeholder="What are you doing?" required />
          <select id="category">
            <option value="">No tag</option>
            <option>Study</option>
            <option>Work</option>
            <option>Gym</option>
            <option>Deep Work</option>
            <option>Content</option>
            <option>Admin</option>
          </select>
          <textarea id="notes" placeholder="Notes (optional)"></textarea>
          <button id="clockInBtn" class="btn success" type="button">Clock In</button>
          <button id="clockOutBtn" class="btn warn" type="button" disabled>Clock Out</button>
        </form>
        <div class="status" id="statusLine">Not tracking.</div>
      </div>
    </div>

    <div class="card" style="width:100%; max-width:1100px;">
      <div class="section-title">Entries</div>
      <div style="overflow:auto;">
        <table id="entriesTable" aria-label="Time entries">
          <thead>
            <tr>
              <th>Date</th>
              <th>Start</th>
              <th>End</th>
              <th class="right">Duration</th>
              <th>Activity</th>
              <th>Tag</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="entriesBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="footer">Made for <strong>Meri</strong> — Press <strong>F</strong> to toggle full screen • Press <strong>S</strong> to start/stop</div>

<script>
  // ===== Utilities =====
  const pad = (n)=> n.toString().padStart(2,'0');
  const fmtDate = (d)=> new Intl.DateTimeFormat(undefined,{year:'numeric',month:'2-digit',day:'2-digit'}).format(d);
  const fmtTime = (d, is24)=>{
    if(is24) return pad(d.getHours())+':'+pad(d.getMinutes())+':'+pad(d.getSeconds());
    const hours = d.getHours()%12 || 12;
    const ampm = d.getHours()>=12?'PM':'AM';
    return pad(hours)+':'+pad(d.getMinutes())+':'+pad(d.getSeconds())+' '+ampm;
  };
  const msToHMS = (ms)=>{
    const s = Math.max(0, Math.floor(ms/1000));
    const hh = Math.floor(s/3600);
    const mm = Math.floor((s%3600)/60);
    const ss = s%60;
    return (hh>0?hh+':':'') + pad(mm) + ':' + pad(ss);
  };

  // ===== Flip clock =====
  function createFlipDigit(initial){
    const el = document.createElement('div');
    el.className='flip'; el.dataset.value=initial;
    const face=document.createElement('div'); face.className='card-face';
    const top=document.createElement('div'); top.className='half top'; const ts=document.createElement('span'); ts.className='digit'; ts.textContent=initial; top.appendChild(ts);
    const bottom=document.createElement('div'); bottom.className='half bottom'; const bs=document.createElement('span'); bs.className='digit'; bs.textContent=initial; bottom.appendChild(bs);
    face.appendChild(top); face.appendChild(bottom); el.appendChild(face);
    return el;
  }
  function flipTo(el, newNumber){
    const old = el.dataset.value;
    if(newNumber===old) return;
    el.dataset.value = newNumber;

    const topFlip=document.createElement('div'); topFlip.className='top-flip'; topFlip.innerHTML='<span class="digit">'+old+'</span>';
    const bottomFlip=document.createElement('div'); bottomFlip.className='bottom-flip'; bottomFlip.innerHTML='<span class="digit">'+newNumber+'</span>';

    const face=el.querySelector('.card-face');
    const top = el.querySelector('.top .digit');
    const bottom = el.querySelector('.bottom .digit');
    top.textContent = old;
    bottom.textContent = old;

    topFlip.animate([{transform:'rotateX(0deg)'},{transform:'rotateX(-90deg)'}],{duration:350,easing:'ease-in',fill:'forwards'})
      .addEventListener('finish', ()=>{
        top.textContent=newNumber;
        bottomFlip.animate([{transform:'rotateX(90deg)'},{transform:'rotateX(0deg)'}],{duration:350,easing:'ease-out',fill:'forwards'})
          .addEventListener('finish', ()=>{
            bottom.textContent=newNumber; topFlip.remove(); bottomFlip.remove();
          });
      });

    face.appendChild(topFlip); face.appendChild(bottomFlip);
  }
  function mountSegment(parent, twoDigits){
    if(parent.children.length===0){
      parent.appendChild(createFlipDigit(twoDigits[0]));
      parent.appendChild(createFlipDigit(twoDigits[1]));
    }else{
      flipTo(parent.children[0], twoDigits[0]);
      flipTo(parent.children[1], twoDigits[1]);
    }
  }

  const hoursSeg=document.getElementById('hoursSeg');
  const minsSeg=document.getElementById('minsSeg');
  const secsSeg=document.getElementById('secsSeg');
  const dateLine=document.getElementById('dateLine');
  const tzLabel=document.getElementById('tzLabel');

  function renderClock(){
    const now = new Date();
    const is24 = document.getElementById('formatToggle').checked;
    let h = now.getHours();
    if(!is24) h = h % 12 || 12;
    mountSegment(hoursSeg, pad(h));
    mountSegment(minsSeg, pad(now.getMinutes()));
    mountSegment(secsSeg, pad(now.getSeconds()));
    const fmt = new Intl.DateTimeFormat(undefined,{weekday:'long',year:'numeric',month:'long',day:'numeric'});
    dateLine.textContent = fmt.format(now);
    try{
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
      tzLabel.textContent = tz.replace('_',' ');
    }catch(e){ tzLabel.textContent='Local Time'; }
  }
  setInterval(renderClock, 1000);
  renderClock();

  // ===== Theme / toggles / fullscreen =====
  const themeToggle=document.getElementById('themeToggle');
  const fmtToggle=document.getElementById('formatToggle');
  themeToggle.addEventListener('change', ()=>{
    document.documentElement.dataset.theme = themeToggle.checked ? 'light' : '';
  });
  fmtToggle.addEventListener('change', renderClock);
  const fsBtn=document.getElementById('fullscreenBtn');
  fsBtn.addEventListener('click', ()=>{
    if(!document.fullscreenElement){ document.documentElement.requestFullscreen().catch(()=>{}); }
    else{ document.exitFullscreen(); }
  });
  document.addEventListener('keydown', (e)=>{
    if(e.target.tagName==='INPUT' || e.target.tagName==='TEXTAREA') return;
    if(e.key.toLowerCase()==='f') fsBtn.click();
  });

  // ===== Time Logger =====
  const LS_KEY_ENTRIES = 'meri_time_entries';
  const LS_KEY_ACTIVE = 'meri_active_session';

  const activityInput = document.getElementById('activity');
  const notesInput = document.getElementById('notes');
  const categorySelect = document.getElementById('category');
  const clockInBtn = document.getElementById('clockInBtn');
  const clockOutBtn = document.getElementById('clockOutBtn');
  const statusLine = document.getElementById('statusLine');
  const tbody = document.getElementById('entriesBody');
  const exportBtn = document.getElementById('exportBtn');
  const clearBtn = document.getElementById('clearBtn');

  function loadEntries(){ try{ return JSON.parse(localStorage.getItem(LS_KEY_ENTRIES)||'[]'); }catch(_){ return []; } }
  function saveEntries(list){ localStorage.setItem(LS_KEY_ENTRIES, JSON.stringify(list)); }
  function loadActive(){ try{ return JSON.parse(localStorage.getItem(LS_KEY_ACTIVE) || 'null'); }catch(_){ return null; } }
  function saveActive(obj){ if(obj) localStorage.setItem(LS_KEY_ACTIVE, JSON.stringify(obj)); else localStorage.removeItem(LS_KEY_ACTIVE); }

  function renderEntries(){
    const is24 = fmtToggle.checked;
    const rows = loadEntries();
    tbody.innerHTML='';
    rows.forEach((r, idx)=>{
      const tr=document.createElement('tr');
      const start = new Date(r.start);
      const end = r.end ? new Date(r.end) : null;
      const durationMs = r.durationMs ?? (end ? (end - start) : 0);
      tr.innerHTML = `
        <td>${fmtDate(start)}</td>
        <td>${fmtTime(start, is24)}</td>
        <td>${end ? fmtTime(end, is24) : '-'}</td>
        <td class="right">${durationMs?msToHMS(durationMs):'-'}</td>
        <td>${escapeHtml(r.activity||'')}</td>
        <td>${r.category? `<span class="tag">${escapeHtml(r.category)}</span>`:''}</td>
        <td>${escapeHtml(r.notes||'')}</td>
        <td class="actions">
          <button class="btn ghost" data-del="${idx}">Delete</button>
        </td>`;
      tbody.appendChild(tr);
    });
    // hook delete buttons
    tbody.querySelectorAll('[data-del]').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const i = Number(e.currentTarget.dataset.del);
        const list = loadEntries(); list.splice(i,1); saveEntries(list); renderEntries();
      });
    });
  }

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  let activeTicker = null;
  function renderStatus(){
    const active = loadActive();
    if(active){
      const started = new Date(active.start);
      const tick = ()=>{
        statusLine.innerHTML = `<span class="pill">Tracking <strong>${escapeHtml(active.activity)}</strong> • ${active.category?('<span class="tag">'+escapeHtml(active.category)+'</span>'):''} • Started ${fmtTime(started, fmtToggle.checked)} • Elapsed <strong>${msToHMS(new Date()-started)}</strong></span>`;
      };
      tick();
      if(activeTicker) clearInterval(activeTicker);
      activeTicker = setInterval(tick, 1000);
      clockInBtn.disabled = true;
      clockOutBtn.disabled = false;
    }else{
      if(activeTicker) clearInterval(activeTicker);
      statusLine.textContent = 'Not tracking.';
      clockInBtn.disabled = false;
      clockOutBtn.disabled = true;
    }
  }

  function clockIn(){
    const activity = activityInput.value.trim();
    if(!activity){ activityInput.focus(); activityInput.reportValidity(); return; }
    if(loadActive()){ alert('Already tracking. Clock out first.'); return; }
    const category = categorySelect.value;
    const notes = notesInput.value.trim();
    const obj = { activity, category, notes, start: new Date().toISOString() };
    saveActive(obj);
    renderStatus();
    // optional: clear notes for a fresh start next time
    // notesInput.value='';
  }

  function clockOut(){
    const active = loadActive();
    if(!active){ alert('No active session.'); return; }
    const end = new Date();
    const start = new Date(active.start);
    const durationMs = Math.max(0, end - start);
    const rows = loadEntries();
    rows.unshift({
      activity: active.activity,
      category: active.category,
      notes: active.notes,
      start: start.toISOString(),
      end: end.toISOString(),
      durationMs
    });
    saveEntries(rows);
    saveActive(null);
    renderStatus();
    renderEntries();
  }

  clockInBtn.addEventListener('click', clockIn);
  clockOutBtn.addEventListener('click', clockOut);

  // Keyboard shortcut: S toggles start/stop (when not typing)
  document.addEventListener('keydown', (e)=>{
    const tag = (e.target.tagName||'').toLowerCase();
    if(tag==='input' || tag==='textarea' || e.metaKey || e.ctrlKey || e.altKey) return;
    if(e.key.toLowerCase()==='s'){
      if(loadActive()) clockOut();
      else clockIn();
    }
  });

  // Export CSV
  exportBtn.addEventListener('click', ()=>{
    const rows = loadEntries();
    const is24 = fmtToggle.checked;
    const header = ['Date','Start','End','Duration(hh:mm:ss)','Activity','Tag','Notes'];
    const lines = [header.join(',')];
    rows.forEach(r=>{
      const start = new Date(r.start);
      const end = r.end ? new Date(r.end) : null;
      const fields = [
        fmtDate(start),
        fmtTime(start, is24),
        end ? fmtTime(end, is24) : '',
        r.durationMs ? msToHMS(r.durationMs) : '',
        (r.activity||'').replace(/"/g,'""'),
        (r.category||'').replace(/"/g,'""'),
        (r.notes||'').replace(/"/g,'""')
      ].map(v=> /[",\n]/.test(v) ? `"${v}"` : v );
      lines.push(fields.join(','));
    });
    const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'meri_time_entries.csv';
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 5000);
  });

  // Clear all
  clearBtn.addEventListener('click', ()=>{
    if(!confirm('Delete all saved entries? This cannot be undone.')) return;
    saveEntries([]); saveActive(null); renderEntries(); renderStatus();
  });

  // Initialize UI from localStorage
  renderEntries();
  renderStatus();
</script>
</body>
</html>
